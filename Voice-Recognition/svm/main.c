#include "stm32f4xx.h"
#include "misc.h"
#include "stm32f4xx_usart.h"
#include "stm32f4xx_gpio.h"
#include "stm32f4xx_dma.h"
#include "stm32f4xx_rcc.h"
#include "arm_math.h"
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

typedef struct
{
  float real;
  float imag;
 }COMPLEX;


#define BUFFERSIZE 2048
#define windowLength 1024
int Threshold=-200;
uint8_t usart[BUFFERSIZE];
float nonpermanentbuffer[windowLength/2];
float Pi=3.1415926;
float Fs=44100;
float mfccParamsmfccFilterWeights[40][80];
float mfccParamsmfccDCTMatrix[13][40];
float collect=0;
float collect2=0;
float testOutput[1024];
float hamming_window[1024];
float usartreal[windowLength];
float mfccs_block[13][40];
float ceps[13];
COMPLEX testInput[windowLength];
int i,k,n=0;

void Delay(uint32_t delay) {
    while (delay--);
}

void NVIC_Configuration(void){
 NVIC_InitTypeDef NVIC_InitStructure; 
           /* Enable the DMA Stream IRQ Channel */
  NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream2_IRQn;
  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
  NVIC_Init(&NVIC_InitStructure);
}

void USART1_Configuration(void){

  /* USART1 clocku ayarlanýyor */
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);
   
  /* USART1 tx ve rx pinlerinin dahil olduðu GPIOB clock ayarý yapýlýyor */
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);
  
  GPIO_InitTypeDef GPIO_InitStructure; //GPIO ayarlama açýlýyor
  /*-------------------------- GPIO Configuration ----------------------------*/
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7; //pin 6 ve pin 7 seçiliyor
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF; //alternatif fonksiyon mode olarak ayarlanýyor zaten bu pinler kit tarafýndan usart1 için ayarlanmýþ pinler
  GPIO_InitStructure.GPIO_OType = GPIO_OType_PP; //pin çýkýþlarý lojik 1 olarak ayarlanýr
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL; //pull up ve pull down dirençleri aktif deðildir
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; //pin hýzý 50MHz seçildi
  GPIO_Init(GPIOB, &GPIO_InitStructure);
   
  /* USART1 pinleri AF Mode a dahil olduðu için belirtmemiz gerekir */
  GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_USART1); // USART1_TX pini
  GPIO_PinAFConfig(GPIOB, GPIO_PinSource7, GPIO_AF_USART1); // USART1_RX pini
 
  USART_InitTypeDef USART_InitStructure; //Usart1 ayarlamasý açýldý   
  /* 
        - BaudRate = 115200 baud
        - Word Length = 8 Bits
        - One Stop Bit
        - No parity
        - Hardware flow control disabled (RTS and CTS signals)
        - Receive and transmit enabled
  */
  USART_InitStructure.USART_BaudRate = 115200;
  USART_InitStructure.USART_WordLength = USART_WordLength_8b; //usart bit uzunluðu 8bit
  USART_InitStructure.USART_StopBits = USART_StopBits_1;     // 1 adet stop biti
  USART_InitStructure.USART_Parity = USART_Parity_No;       // baþlangýç biti yok
  USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None; //rts ve cts veri iletiþimi için kullanýlan diðer pinler þuan için gerekli deðil
   
  USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx; // Usart veri alma ve gönderme iþlemleri aktif
   
  USART_Init(USART1, &USART_InitStructure); //Usart ayarlamasý bitti

   
  USART_Cmd(USART1, ENABLE); //Usart1 aktif halde
}

void DMA_Configuration(void){
  DMA_InitTypeDef DMA_InitStructure;
  
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2, ENABLE);
  
  DMA_InitStructure.DMA_Channel = DMA_Channel_4;//dma kanalý seçildi
  DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&usart[0]; //hafýzanýn baþlayacaðý adres belirtildi
  DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&USART1->DR; //taþýnacak verinin adresi belirtildi
  DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory; // verinin taþýma yönü belirtildi 
  DMA_InitStructure.DMA_BufferSize = BUFFERSIZE;     //buffer büyüklüðü dma ya bildiriliyor
  DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable; //adc verilerinin bulunduðu register adresinde bir artýrma olmayacak
  DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable; //hafýzanýn artacaðý belirtildi
  DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte; //adc verilerinin uzunluðu 16 bit seçildi
  DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte; // hafýza verilerinin uzunluðu 16 bit seçildi
  DMA_InitStructure.DMA_Mode = DMA_Mode_Circular; //dma mod normal
  DMA_InitStructure.DMA_Priority = DMA_Priority_High; //bir çok dma kanalý aktif iken kullanýlýr dma önceliði yüksek olarak seçiliyor
  DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable; //fifo mode kapalý dma da peripheral ve memory arasýnda fifo bellekler (sram) bulunur 
  //fifo mode kapalýyken direct mode, açýkken burst mode kullanýlabilir.
  DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull; //(1/4,1/2,3/4,Full)  
  //single,INC4,INC8 ve INC16
  DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;  
  DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single; 
  DMA_Init(DMA2_Stream2, &DMA_InitStructure);
  DMA_ITConfig(DMA2_Stream2, DMA_IT_TC | DMA_IT_HT, ENABLE); 
  USART_DMACmd(USART1,USART_DMAReq_Rx,ENABLE);    
  DMA_Cmd(DMA2_Stream2, ENABLE);/* DMA2_Stream0 aktif halde */
}
  

void feature_mfccs_init(void){
 ///////////////////////////////////////////////////////
    /////////#define mfccParamscepstralCoefficients 13
  float mfccParamslogFilters =27;
  float mfccParamsfftSize = 512 ;
  float mfccParamscepstralCoefficients =13;
  float mfccParamstotalFilters =40;
  // fft resolution:
/////////#define mfccParamsfftSize  512 //round( windowLength / 2)
  // filter parameters:
  float mfccParamslowestFrequency =133.3333;
  float mfccParamslinearSpacing =66.66666666;
 //////// double mfccParamslogFilters =27;
  float mfccParamslogSpacing =1.0711703;
  float mfccParamsfreqs[42];
/////////#define mfccParamstotalFilters 40 //( mfccParamslinearFilters + mfccParamslogFilters)

  //  mfccParamsfreqs = mfccParamslowestFrequency + (0:mfccParamslinearFilters-1)*mfccParamslinearSpacing;
  int a=0,b;
  for(a=0;a<13;a++)
    mfccParamsfreqs[a] = mfccParamslowestFrequency + a*mfccParamslinearSpacing;

 // mfccParamsfreqs(mfccParamslinearFilters+1:mfccParamstotalFilters+2) = mfccParamsfreqs(mfccParamslinearFilters) * mfccParamslogSpacing.^(1:mfccParamslogFilters+2);

  for(a=1;a<=mfccParamslogFilters+2;a++)
    mfccParamsfreqs[12+a]=mfccParamsfreqs[12]*pow(mfccParamslogSpacing,a);

//  mfccParamslower = mfccParamsfreqs(1:mfccParamstotalFilters);
  float mfccParamslower[40];

  for(a=0;a<mfccParamstotalFilters;a++)
    mfccParamslower[a] = mfccParamsfreqs[a];

//  mfccParamscenter = mfccParamsfreqs(2:mfccParamstotalFilters+1);
  float mfccParamscenter[40];

  for(a=1;a<mfccParamstotalFilters+1;a++)
    mfccParamscenter[a-1] = mfccParamsfreqs[a];

//  mfccParamsupper = mfccParamsfreqs(3:mfccParamstotalFilters+2);
  float mfccParamsupper[40];

  for(a=2;a<mfccParamstotalFilters+2;a++)
    mfccParamsupper[a-2] = mfccParamsfreqs[a];

//  mfccParamsmfccFilterWeights = zeros(mfccParamstotalFilters,mfccParamsfftSize);
////////   double mfccParamsmfccFilterWeights[mfccParamstotalFilters][mfccParamsfftSize];

//  mfccParamstriangleHeight = 2./(mfccParamsupper-mfccParamslower);
   float  mfccParamstriangleHeight[40];

   for(a=0;a<mfccParamstotalFilters;a++)
     mfccParamstriangleHeight[a] = 2/(mfccParamsupper[a]-mfccParamslower[a]);

//  mfccParamsfftFreqs = (0:mfccParamsfftSize-1)/mfccParamsfftSize*fs;
   float mfccParamsfftFreqs[512]; //mfccParamsfftSize

   for(a=0;a<mfccParamsfftSize;a++)
      mfccParamsfftFreqs[a]=Fs*a/mfccParamsfftSize;

 ///////////////////
 /* for chan=1:mfccParamstotalFilters //for each filter:
    // compute the respective filter weights:
    mfccParamsmfccFilterWeights(chan,:) = (mfccParamsfftFreqs > mfccParamslower(chan) & mfccParamsfftFreqs <= mfccParamscenter(chan))     .* mfccParamstriangleHeight(chan)   .*(mfccParamsfftFreqs-mfccParamslower(chan))/(mfccParamscenter(chan)-mfccParamslower(chan)) + (mfccParamsfftFreqs > mfccParamscenter(chan) & mfccParamsfftFreqs < mfccParamsupper(chan)).* mfccParamstriangleHeight(chan).*(mfccParamsupper(chan)-mfccParamsfftFreqs)/(mfccParamsupper(chan)-mfccParamscenter(chan));
  end
*/

  for(a=0;a<mfccParamstotalFilters;a++)
    for(b=0;b<mfccParamsfftSize;b++)
      mfccParamsmfccFilterWeights[a][b] =((mfccParamsfftFreqs[b] > mfccParamslower[a]) & (mfccParamsfftFreqs[b] <= mfccParamscenter[a]))*mfccParamstriangleHeight[a]*(mfccParamsfftFreqs[b]-mfccParamslower[a])/(mfccParamscenter[a]-mfccParamslower[a]) + ((mfccParamsfftFreqs[b] > mfccParamscenter[a]) & (mfccParamsfftFreqs[b] < mfccParamsupper[a]))* mfccParamstriangleHeight[a]*(mfccParamsupper[a]-mfccParamsfftFreqs[b])/(mfccParamsupper[a]-mfccParamscenter[a]);

  ////////////////
  // matrix used in the DCT calculation:
 // mfccParamsmfccDCTMatrix = 1/sqrt(mfccParamstotalFilters/2)*cos( (0:(mfccParamscepstralCoefficients-1))' * (2*(0:(mfccParamstotalFilters-1))+1) * pi/2/mfccParamstotalFilters);
 // mfccParamsmfccDCTMatrix(1,:) = mfccParamsmfccDCTMatrix(1,:) * sqrt(2)/2;
/////////////////  double mfccParamsmfccDCTMatrix[mfccParamscepstralCoefficients][mfccParamstotalFilters];
  for (a = 0; a<mfccParamscepstralCoefficients; a++)
    for (b = 0; b<mfccParamstotalFilters; b++){
              mfccParamsmfccDCTMatrix[a][b] =1/sqrt(mfccParamstotalFilters/2)* cos( a*(2*b+1)* Pi/2/mfccParamstotalFilters);
    }
  
   for (b = 0; b<mfccParamstotalFilters; b++)
         mfccParamsmfccDCTMatrix[0][b] =mfccParamsmfccDCTMatrix[0][b]*sqrt(2)/2;
    ///////////////////////////////////////////////////////
    
}

void GPIO_Configuration(void){
  GPIO_InitTypeDef GPIO_InitDef;
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOD, ENABLE);// Hangi port olduðunu belirliyoruz (D portu)
  /*xxx*/
  GPIO_InitDef.GPIO_Pin = GPIO_Pin_12 | GPIO_Pin_13 | GPIO_Pin_14 | GPIO_Pin_15 ; // hangi pini kullanacaðýmýzý belirliyoruz (12. pin)
  GPIO_InitDef.GPIO_Mode = GPIO_Mode_OUT; // çýkýþ olarak ayarlýyoruz
  GPIO_InitDef.GPIO_OType = GPIO_OType_PP;
  GPIO_InitDef.GPIO_PuPd = GPIO_PuPd_NOPULL;
  GPIO_InitDef.GPIO_Speed = GPIO_Speed_100MHz;
  //Initialize pins
  GPIO_Init(GPIOD, &GPIO_InitDef);
}

float SupportVectors[125][26]={{-25.016813,1.674782,0.570302,0.055831,0.542827,0.195742,-0.408398,-0.154678,-0.129031,-0.065453,-0.005136,-0.338932,0.408109,31.962882,0.807270,1.040891,0.257747,0.267930,0.118487,0.154393,0.138944,0.156755,0.056090,0.203793,0.199853,0.190082},
{-20.913284,1.588457,0.666204,0.050123,0.331438,0.203750,0.294239,0.134841,0.079160,-0.298463,-0.116695,-0.374979,0.093225,87.281118,3.258930,0.563078,0.093044,0.213056,0.155831,0.200358,0.152310,0.106339,0.115771,0.104865,0.211828,0.168822},
{-25.894186,0.843509,-0.058631,0.643821,0.167292,0.189467,-0.510659,-0.306875,-0.437351,-0.066706,-0.092706,-0.205270,-0.335486,26.948295,2.306288,0.277463,0.114741,0.113568,0.132388,0.189681,0.116535,0.150499,0.111565,0.123296,0.140659,0.153987},
{-25.325273,0.912474,0.192047,0.438090,0.149315,0.062922,-0.456985,-0.274804,-0.297498,-0.081469,-0.114463,-0.157783,-0.153322,50.080355,1.400112,0.712126,0.294951,0.090390,0.134029,0.224551,0.102585,0.100119,0.086245,0.096345,0.078083,0.073046},
{-25.862670,1.217321,-0.197057,0.465168,-0.005088,0.359509,-0.290814,-0.315632,-0.202137,-0.206919,-0.162654,0.156706,-0.382151,25.158920,0.631282,0.114051,0.108476,0.072217,0.240171,0.350840,0.073196,0.108025,0.049907,0.129342,0.093083,0.039930},
{-23.616874,0.553403,0.383378,0.548440,0.348671,0.226624,-0.342699,-0.338475,-0.261570,0.011724,-0.081808,-0.261837,-0.101800,36.856375,0.848000,0.237463,0.127244,0.153630,0.222089,0.259417,0.200940,0.073543,0.146180,0.057780,0.088514,0.090625},
{-22.813065,0.616454,0.309262,0.343467,0.283398,-0.183829,-0.103958,-0.203224,-0.278170,-0.170281,-0.148871,-0.024385,-0.267069,99.873554,2.248558,0.544983,0.143398,0.161266,0.122492,0.388099,0.352475,0.068110,0.128751,0.141076,0.098119,0.063041},
{-23.201371,0.919022,0.417351,0.551648,0.219968,-0.112016,-0.206249,-0.091299,-0.209009,-0.129427,-0.021627,0.009459,-0.382530,98.118902,1.778473,0.442810,0.175250,0.157478,0.058401,0.427060,0.467646,0.054641,0.155667,0.184508,0.049061,0.073271},
{-26.945792,1.761423,0.104608,0.328659,0.128024,-0.116033,-0.401684,-0.597639,-0.205041,0.082129,-0.152431,-0.026645,-0.182979,41.290150,0.650381,0.298582,0.102211,0.085753,0.060336,0.149340,0.136399,0.077595,0.076189,0.040087,0.059874,0.064353},
{-25.904443,1.658256,-0.055069,0.490945,0.013669,0.103622,-0.601064,-0.504625,-0.095753,-0.038191,-0.140390,-0.268970,-0.352683,46.893589,1.281676,0.578303,0.335045,0.128526,0.073074,0.083203,0.091689,0.140350,0.097787,0.065503,0.062438,0.052237},
{-27.405477,1.526064,-0.298495,0.353339,0.075120,-0.102277,-0.609137,-0.585161,-0.266764,-0.087905,-0.071913,-0.085091,-0.377736,59.619433,0.640419,0.170335,0.134705,0.123757,0.108545,0.112017,0.103999,0.176578,0.060601,0.088425,0.045074,0.100815},
{-21.951023,0.334587,0.288610,0.601830,0.224985,-0.096952,-0.438334,-0.046277,-0.182992,-0.078621,0.179100,0.016329,0.104588,51.419151,3.393482,0.559514,0.190293,0.237830,0.282414,0.147664,0.105254,0.144716,0.179163,0.171487,0.202795,0.100329},
{-20.840069,-0.335646,-0.746190,0.433621,0.078093,-0.675221,-0.695668,0.133431,-0.767731,-0.118836,0.462686,0.003339,0.250653,69.118006,1.200325,0.566823,0.447104,0.087499,0.156752,0.221900,0.139138,0.167114,0.109893,0.103500,0.352792,0.388176},
{-23.505827,1.568790,0.032874,0.733774,-0.088041,-0.042429,-0.013286,-0.285498,-0.151144,-0.004576,-0.121360,-0.127857,0.136844,43.200272,1.270323,0.565952,0.363922,0.711959,0.292300,0.115336,0.232767,0.224572,0.162996,0.234796,0.058695,0.157358},
{-21.039321,1.792887,0.264921,0.642738,0.582641,0.368897,-0.281150,-0.176678,-0.330144,0.155748,-0.077478,0.043707,0.108082,53.928486,2.064974,1.148073,0.279800,0.212248,0.217729,0.239987,0.184793,0.134335,0.116847,0.129785,0.053324,0.101497},
{-24.576405,1.642509,0.125211,0.469739,0.469480,0.096754,-0.395744,-0.462028,-0.192679,0.081918,-0.131889,0.109282,-0.115485,28.403059,0.134269,0.168905,0.202358,0.184708,0.098687,0.082541,0.094699,0.081869,0.080741,0.131156,0.082828,0.069338},
{-26.311454,1.807525,0.167293,0.229452,-0.102589,-0.274391,-0.550947,-0.408105,-0.134086,-0.046551,-0.165389,-0.058307,-0.218112,47.052548,0.707494,0.256514,0.203797,0.194061,0.236677,0.127421,0.070980,0.110862,0.066290,0.094464,0.041061,0.045770},
{-22.156209,2.051289,0.948182,0.188298,0.852182,0.360679,-0.199220,-0.099427,-0.108467,0.057966,0.076197,-0.523860,0.335912,34.022335,1.489390,0.239301,0.470072,0.157898,0.075566,0.284378,0.181499,0.202756,0.117285,0.089340,0.213573,0.116033},
{-28.245547,1.617097,0.033563,0.309597,0.137856,-0.121140,-0.612706,-0.448578,-0.177543,-0.125188,0.053938,-0.102774,-0.281154,48.911635,1.173088,0.264312,0.093643,0.049302,0.070340,0.065073,0.083010,0.034121,0.099203,0.092238,0.061687,0.099891},
{-27.048263,2.125453,-0.399062,0.679428,0.226742,-0.132939,-0.574871,-0.358313,-0.100902,-0.044740,-0.038536,-0.129114,-0.426951,28.752667,0.297512,0.090746,0.187773,0.303027,0.151674,0.063948,0.178039,0.045590,0.079896,0.085239,0.059073,0.046212},
{-20.647495,3.318821,0.499276,0.467891,0.250471,-0.057072,-0.206629,-0.270078,-0.280455,0.140521,-0.110018,0.077775,0.019536,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000},
{-24.817790,2.188259,0.041841,0.297641,0.028876,-0.020389,-0.504805,-0.448059,-0.257005,0.021341,0.063429,0.014338,-0.106718,54.581283,0.823207,0.296705,0.072434,0.104155,0.076457,0.121070,0.082919,0.068552,0.068646,0.062596,0.062813,0.057514},
{-23.636574,2.345888,-0.130328,0.093168,0.030045,-0.072236,-0.523847,-0.476158,-0.328854,0.007984,-0.056683,0.107546,-0.193136,68.114414,0.865908,0.502332,0.244917,0.170938,0.130098,0.121476,0.117998,0.113326,0.098322,0.069222,0.064756,0.078288},
{-21.728734,2.723793,-0.322811,0.127291,-0.168421,-0.067449,-0.504557,-0.437378,-0.295609,-0.014920,-0.015856,0.017992,-0.249917,56.981644,1.102886,0.412555,0.320078,0.206160,0.061308,0.083369,0.159317,0.144150,0.082784,0.052252,0.065928,0.054432},
{-19.864335,0.192703,-1.232353,0.751406,0.442014,0.233866,-0.386511,-0.335879,-0.294309,0.265957,-0.148252,0.056493,-0.041761,13.424184,1.373433,1.169402,0.119660,0.264357,0.155913,0.125334,0.208180,0.111823,0.116988,0.100192,0.061830,0.075460},
{-20.258868,0.709961,-1.045846,0.397235,0.524447,0.403586,-0.420334,-0.326471,-0.198212,0.060566,-0.194729,-0.180098,-0.055517,26.654357,0.955993,0.501976,0.186423,0.191377,0.175429,0.163586,0.105331,0.076758,0.103906,0.056752,0.097790,0.101293},
{-19.329552,0.956324,-0.504127,0.765427,0.386396,0.348055,-0.471764,-0.359347,-0.174139,0.311686,-0.263529,-0.150093,0.151234,27.512212,1.003467,0.373605,0.152261,0.170608,0.232004,0.097196,0.101409,0.134555,0.093842,0.109350,0.056823,0.113648},
{-22.327960,1.371074,-1.212497,0.177706,-0.061222,0.116122,-0.307517,-0.535920,-0.352179,0.271577,-0.072407,-0.125308,0.056410,42.354488,0.886868,0.455959,0.359552,0.107321,0.227457,0.133827,0.115587,0.066427,0.071155,0.121566,0.053263,0.127760},
{-23.662207,1.554976,-0.673548,0.300180,0.264968,0.053662,-0.355005,0.051897,0.196386,0.135500,-0.059076,0.057901,-0.211170,56.901459,1.701142,1.764992,0.453780,0.140088,0.137734,0.122430,0.185218,0.089979,0.091137,0.113155,0.047132,0.051894},
{-25.883730,2.431293,-0.325276,0.285603,0.000793,-0.128304,-0.468143,-0.516990,-0.306544,-0.166468,-0.132575,-0.085097,-0.271940,55.799135,1.420122,0.187968,0.122973,0.158680,0.099957,0.072172,0.075122,0.080898,0.109823,0.095366,0.063255,0.062718},
{-23.521674,2.901761,-0.040718,0.149446,0.006315,-0.153696,-0.424788,-0.484797,-0.328560,-0.089327,-0.266883,-0.189590,-0.145101,43.214987,1.798719,0.211974,0.205337,0.228780,0.096078,0.096307,0.066124,0.110825,0.076039,0.061360,0.050950,0.093087},
{-23.243130,2.430525,-0.042407,0.263166,0.140869,-0.223116,-0.421970,-0.541554,-0.403411,0.041352,-0.084212,-0.140946,-0.133518,43.988012,2.256788,0.278434,0.201498,0.245870,0.123876,0.134062,0.136576,0.121478,0.055592,0.040432,0.089981,0.058249},
{-25.632129,3.154345,-0.251689,0.367802,0.045068,-0.113122,-0.551585,-0.642331,-0.390068,-0.098488,-0.072413,-0.139658,-0.305445,36.630823,2.982355,0.127385,0.105428,0.131264,0.074044,0.135871,0.132528,0.168738,0.104648,0.091232,0.101188,0.076824},
{-25.805874,1.761766,0.041008,0.529499,0.362624,-0.006684,-0.506381,-0.344368,-0.330441,0.076641,-0.049039,-0.142185,-0.191770,45.487498,0.534559,0.470408,0.129294,0.132250,0.138835,0.095793,0.108821,0.075038,0.103972,0.072629,0.094131,0.058685},
{-26.480945,2.918569,0.212380,0.790043,0.388440,0.160064,-0.422058,-0.426545,-0.266607,0.015784,0.060349,-0.021000,-0.294736,25.370977,0.864746,0.280153,0.104337,0.069048,0.073691,0.081631,0.120875,0.115307,0.114603,0.056723,0.080637,0.049766},
{-15.624090,-0.205319,-1.022392,-0.006666,-0.385955,-0.353999,-0.144994,-0.500161,-0.329816,0.412545,-0.152003,0.020513,-0.005849,18.538685,0.669460,0.523375,0.199202,0.117084,0.071416,0.115540,0.108228,0.075439,0.104815,0.091311,0.080916,0.057933},
{-27.405477,1.526064,-0.298495,0.353339,0.075120,-0.102277,-0.609137,-0.585161,-0.266764,-0.087905,-0.071913,-0.085091,-0.377736,59.619433,0.640419,0.170335,0.134705,0.123757,0.108545,0.112017,0.103999,0.176578,0.060601,0.088425,0.045074,0.100815},
{-23.711959,0.911461,-0.559938,0.332538,-0.202107,-0.292696,-0.841556,-0.766497,-0.842355,-0.120129,0.137439,-0.174096,-0.189632,46.617919,1.611337,0.446785,0.184075,0.084227,0.100775,0.109285,0.101419,0.308593,0.108653,0.198810,0.080690,0.067365},
{-26.407940,1.954069,-0.209562,0.483256,-0.512901,-0.501696,-0.339250,-0.630702,-0.679728,-0.441910,-0.756758,-0.141612,-0.010270,18.036892,0.983830,0.223291,0.051681,0.303265,0.122406,0.284279,0.110230,0.084390,0.107666,0.311674,0.065038,0.138576},
{-24.408033,2.280501,0.050170,0.995964,0.635602,-0.005346,-0.256279,0.082549,-0.362378,-0.011088,-0.215627,0.052990,-0.047037,31.459197,0.816397,0.504074,0.137779,0.158183,0.110211,0.201590,0.106006,0.073677,0.097491,0.102378,0.166202,0.069928},
{-21.039321,1.792887,0.264921,0.642738,0.582641,0.368897,-0.281150,-0.176678,-0.330144,0.155748,-0.077478,0.043707,0.108082,53.928486,2.064974,1.148073,0.279800,0.212248,0.217729,0.239987,0.184793,0.134335,0.116847,0.129785,0.053324,0.101497},
{-14.327102,1.669883,-0.701634,0.777976,0.882408,0.194330,-0.438852,-0.183797,-0.170516,0.233684,-0.445337,0.209798,0.066497,36.844499,0.930212,0.986476,0.278931,0.355425,0.267988,0.296022,0.089399,0.118635,0.126590,0.112953,0.093555,0.068029},
{-25.990194,1.577785,-0.185113,0.400408,0.443376,0.007814,-0.576512,-0.421496,-0.093896,0.092125,0.058547,0.107550,-0.118792,67.784633,0.747861,0.592247,0.161755,0.186464,0.082423,0.098395,0.266221,0.100081,0.068942,0.112054,0.045654,0.076431},
{-16.987667,2.910595,-0.175232,0.982794,0.469628,0.193126,-0.438608,-0.310416,-0.305369,0.195096,-0.486699,0.335001,0.053305,25.056560,1.719613,0.343393,0.247094,0.282295,0.327149,0.152204,0.177909,0.078652,0.120824,0.242097,0.111318,0.079314},
{-26.944891,1.473402,-0.286590,0.539014,-0.035097,-0.173795,-0.481391,-0.573026,-0.016941,0.234738,-0.022017,-0.072529,-0.319101,42.138978,1.288066,0.199592,0.134194,0.123263,0.125367,0.114687,0.111606,0.104842,0.162507,0.074406,0.043617,0.068697},
{-24.930290,2.046194,0.066587,0.867904,0.360652,0.154832,-0.137488,-0.208712,0.114751,0.125404,0.123887,0.015002,-0.167382,46.250449,1.041799,0.532051,0.213243,0.125622,0.189054,0.090041,0.110798,0.112583,0.092211,0.050443,0.046330,0.076589},
{-17.434140,2.528791,-0.410409,0.288950,0.180627,0.190344,-0.301441,-0.298542,0.014489,0.098456,-0.383150,-0.248080,-0.176488,46.706983,2.013110,0.448252,0.182965,0.078208,0.114713,0.072427,0.084167,0.090556,0.101424,0.124903,0.163640,0.052756},
{-17.689654,2.360253,-0.697127,-0.174447,-0.013787,0.003844,-0.497244,-0.346121,-0.148676,-0.182287,-0.627157,-0.227920,-0.316581,7.228097,0.609463,0.259881,0.142898,0.107103,0.226063,0.139624,0.140752,0.056833,0.098657,0.060044,0.075840,0.068085},
{-27.252083,2.662696,0.827873,0.992974,0.422090,0.528759,-0.162159,0.030097,0.205788,0.277610,0.183678,-0.064282,-0.211965,40.196499,0.441461,0.192114,0.300954,0.415611,0.307812,0.168155,0.123272,0.070170,0.072357,0.076110,0.081701,0.051262},
{-22.086358,3.487051,0.885695,0.491377,0.066758,-0.306360,-0.655655,-0.340377,-0.281663,-0.405794,-0.350294,-0.499532,-0.392700,29.316614,0.601180,0.199601,0.250712,0.166338,0.208258,0.126203,0.111189,0.103140,0.127425,0.185421,0.245309,0.081209},
{-15.686683,-0.376542,1.272930,0.010306,0.661931,0.178166,0.212676,-0.148377,0.084573,-0.296254,-0.161919,-0.458404,0.455886,61.705481,1.137521,0.643768,0.181049,0.199573,0.146836,0.406231,0.184892,0.151739,0.165860,0.573630,0.089574,0.217911},
{-15.244403,-0.690654,0.371487,-0.207295,0.549287,0.078052,-0.019304,-0.188021,0.074094,-0.497778,0.038810,-0.333247,0.313503,57.281182,0.926766,0.396733,0.346800,0.276399,0.169580,0.418653,0.101291,0.201986,0.280400,0.142551,0.106984,0.194714},
{-16.046841,-0.657389,1.349752,-0.076634,0.104070,0.100990,-0.060781,-0.299964,-0.523444,0.121417,-0.019239,0.264404,0.088053,19.375598,0.385669,0.216850,0.163497,0.071159,0.173965,0.131141,0.122915,0.102490,0.063947,0.085086,0.079427,0.036862},
{-23.680313,0.822403,0.151143,0.259650,0.004890,-0.212303,-0.495616,-0.307807,-0.389635,-0.033203,-0.066045,0.082340,-0.026071,72.908654,1.146412,0.278798,0.199206,0.097280,0.121583,0.289746,0.095789,0.094250,0.065039,0.127502,0.123596,0.188547},
{-19.992832,-0.247116,0.655262,1.057155,0.241141,0.460688,-0.237182,-0.051554,-0.709198,0.198669,-0.219659,-0.357837,-0.381300,35.588433,1.633437,0.216366,0.102107,0.071094,0.134979,0.192180,0.085811,0.238886,0.083056,0.098866,0.068794,0.092562},
{-19.808662,1.544350,0.621888,0.080573,0.269534,0.518331,1.087189,0.843999,-0.004537,-0.319421,-0.693699,0.173686,-0.256701,72.945410,2.725593,0.346607,0.283082,0.105641,0.157966,0.338118,0.453919,0.099993,0.116412,0.090946,0.058325,0.047466},
{-27.235904,1.342896,0.023390,0.436072,0.131653,-0.191188,-0.449644,-0.244730,-0.272011,-0.121474,-0.076339,0.012444,-0.263024,68.179055,1.531578,0.212314,0.121548,0.168039,0.101898,0.150033,0.363333,0.095838,0.095543,0.080817,0.040171,0.079627},
{-18.448381,0.029298,0.798677,0.318286,0.551049,-0.002777,0.104409,-0.037630,-0.330974,-0.112104,-0.236828,-0.071103,-0.385796,91.491044,1.457686,0.645732,0.143303,0.279587,0.178696,0.259705,0.252209,0.102033,0.102592,0.076263,0.048668,0.068983},
{-19.864335,0.192703,-1.232353,0.751406,0.442014,0.233866,-0.386511,-0.335879,-0.294309,0.265957,-0.148252,0.056493,-0.041761,13.424184,1.373433,1.169402,0.119660,0.264357,0.155913,0.125334,0.208180,0.111823,0.116988,0.100192,0.061830,0.075460},
{-20.382414,1.174930,-1.339335,-0.173852,-0.016667,0.033291,-0.686063,0.022415,0.220615,0.141683,-0.280427,-0.111746,-0.060313,9.671935,1.366367,0.506318,0.229208,0.213490,0.124453,0.147710,0.156280,0.081039,0.068734,0.055316,0.051960,0.068134},
{-26.433380,1.400337,-0.268949,0.418182,0.142618,-0.140878,-0.693754,-0.501236,-0.078066,-0.076502,-0.035522,-0.017850,-0.014203,67.140348,2.476212,0.263332,0.131045,0.096122,0.094082,0.114956,0.084485,0.125112,0.077075,0.082782,0.061666,0.081192},
{-13.699497,-0.216391,-0.261749,0.616664,-0.565160,-0.408178,-1.015486,-0.453364,-0.140140,-0.117628,-0.507533,-0.616352,-0.074585,8.546998,0.562407,0.358513,0.218701,0.138808,0.098035,0.101576,0.135714,0.245841,0.142338,0.245882,0.110678,0.063903},
{-15.624090,-0.205319,-1.022392,-0.006666,-0.385955,-0.353999,-0.144994,-0.500161,-0.329816,0.412545,-0.152003,0.020513,-0.005849,18.538685,0.669460,0.523375,0.199202,0.117084,0.071416,0.115540,0.108228,0.075439,0.104815,0.091311,0.080916,0.057933},
{-27.405477,1.526064,-0.298495,0.353339,0.075120,-0.102277,-0.609137,-0.585161,-0.266764,-0.087905,-0.071913,-0.085091,-0.377736,59.619433,0.640419,0.170335,0.134705,0.123757,0.108545,0.112017,0.103999,0.176578,0.060601,0.088425,0.045074,0.100815},
{-22.318879,1.424643,-0.438956,0.445260,-0.316623,-0.273369,-0.596940,-0.426768,-0.488160,-0.176309,-0.488026,-0.563830,-0.331912,10.528998,2.930055,0.413106,0.265770,0.152205,0.092215,0.120651,0.104041,0.071513,0.089598,0.104396,0.080102,0.068575},
{-17.126827,-0.129502,-0.844803,-0.279216,-0.494734,-0.554331,-0.508213,-0.202413,-0.132659,-0.140033,-0.406187,-0.143986,-0.221833,41.452972,0.889199,0.463550,0.219570,0.117347,0.134682,0.157121,0.058577,0.110850,0.086708,0.121841,0.076898,0.045499},
{-18.949944,0.128577,-0.450541,0.665324,0.201018,-0.065475,-0.352514,-0.332324,0.023243,0.196382,-0.310172,-0.224195,-0.211288,84.363974,1.982685,0.149462,0.423040,0.240681,0.143704,0.069572,0.122863,0.106049,0.080623,0.206935,0.206902,0.111166},
{-20.837463,0.713695,-0.610977,0.130465,-0.246182,-0.365735,-0.753162,-0.484182,0.042103,-0.145197,-0.160308,0.004350,0.058410,83.217598,1.765198,0.352091,0.289248,0.274095,0.171422,0.238157,0.154301,0.111013,0.072316,0.150819,0.069569,0.066671},
{-20.102956,0.482331,0.539466,0.994767,0.414869,0.231347,0.116244,0.551456,0.039795,0.045993,0.455924,-0.006315,-0.138339,44.593726,1.760382,0.812182,0.466035,0.538930,0.288324,0.184622,0.354078,0.163373,0.195342,0.169515,0.043089,0.153526},
{-16.488653,-0.552720,0.377887,1.083479,0.350232,-0.174293,0.125390,0.676910,-0.525818,-0.016056,0.330015,0.032147,0.527190,36.011896,0.727940,0.678282,0.703391,0.216357,0.109802,0.130238,0.474083,0.130198,0.279504,0.143829,0.108830,0.153160},
{-15.772534,-0.376327,0.019941,-0.289529,-0.716194,-0.474656,-0.012539,-0.004901,0.052744,-0.062987,-0.793423,-0.159125,-0.088473,8.048899,0.608050,0.513107,0.181859,0.064066,0.113529,0.305515,0.291727,0.252543,0.191062,0.241534,0.129074,0.170911},
{-24.792671,1.380364,0.928683,1.030869,0.583172,0.377438,0.085901,-0.073293,0.249802,0.204599,0.060075,-0.027889,-0.015741,43.892122,1.900550,0.665426,0.472541,0.556952,0.310757,0.136430,0.343683,0.065706,0.117104,0.109862,0.098997,0.148445},
{-23.484578,1.424078,-0.421311,0.448016,-0.118051,-0.235780,-0.256877,-0.356224,0.026333,0.110652,-0.097011,-0.173665,-0.314212,49.716323,1.100600,0.189283,0.117823,0.137588,0.187235,0.080318,0.085366,0.070630,0.087155,0.112426,0.091145,0.077273},
{-18.549762,1.045670,-0.946839,0.796366,-0.199098,-0.574007,-0.531724,-0.354439,-0.361027,-0.054995,-0.145921,0.177680,0.217673,11.792378,1.676888,0.819947,0.165554,0.155812,0.203574,0.156098,0.140019,0.146572,0.122096,0.119705,0.066277,0.051836},
{-20.482803,0.861408,-0.356644,0.753859,-0.179803,-0.180810,-0.226498,-0.262901,0.154459,0.361623,-0.204453,-0.251261,-0.168273,13.658440,0.662129,0.525867,0.103693,0.154185,0.138321,0.107702,0.082859,0.119459,0.105233,0.115674,0.092601,0.065761},
{-18.794945,2.401952,0.188889,0.020841,-0.442299,-0.579417,-0.393752,-0.158342,0.105287,0.070791,-0.266380,-0.049578,-0.077075,29.519828,1.310907,1.097455,0.187024,0.271103,0.209093,0.118043,0.162603,0.255899,0.214657,0.079996,0.132790,0.071755},
{-14.750247,-0.068061,0.494474,0.108333,0.880017,0.116174,0.395318,0.032586,0.228143,-0.365974,-0.165538,-0.597075,0.779799,40.019851,2.743058,0.847510,0.266697,0.222685,0.218285,0.217285,0.173988,0.123759,0.127181,0.166279,0.131018,0.212184},
{-19.704531,0.494512,0.641749,0.359567,-0.069070,-0.233290,-0.440988,-0.428965,-0.455623,-0.068835,-0.157956,0.366530,0.016611,74.078901,1.367880,0.644902,0.178136,0.130747,0.081535,0.099782,0.103262,0.077049,0.068682,0.096639,0.202733,0.169730},
{-14.716054,-0.776784,1.487676,0.532328,-0.084395,0.110264,-0.106892,-0.307848,-0.556497,-0.161589,-0.066917,0.172062,0.011597,15.174065,0.337107,0.409356,0.215114,0.114192,0.261973,0.189632,0.291051,0.065174,0.066861,0.112257,0.068478,0.069424},
{-14.766414,-0.374582,0.943769,0.568636,0.525889,0.430168,0.525455,0.353779,-0.289290,-0.313519,-0.410616,0.064924,-0.496307,34.933532,1.066042,0.372510,0.194797,0.109878,0.102807,0.299327,0.751058,0.147940,0.099283,0.255255,0.146047,0.029754},
{-27.048263,2.125453,-0.399062,0.679428,0.226742,-0.132939,-0.574871,-0.358313,-0.100902,-0.044740,-0.038536,-0.129114,-0.426951,28.752667,0.297512,0.090746,0.187773,0.303027,0.151674,0.063948,0.178039,0.045590,0.079896,0.085239,0.059073,0.046212},
{-20.647495,3.318821,0.499276,0.467891,0.250471,-0.057072,-0.206629,-0.270078,-0.280455,0.140521,-0.110018,0.077775,0.019536,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000},
{-26.566704,2.066493,-0.121374,0.506846,0.089113,-0.355446,-0.411103,-0.453343,-0.211184,0.189788,0.065919,-0.002550,-0.154275,44.099466,0.688557,0.218785,0.248260,0.143293,0.199002,0.148826,0.090112,0.100743,0.099363,0.055141,0.079675,0.073285},
{-26.377936,1.249873,0.286925,0.579640,0.142303,-0.265282,-0.337833,-0.394794,-0.214356,0.271394,0.037288,0.033818,-0.063562,34.717412,0.535257,0.232425,0.198134,0.074696,0.074686,0.227052,0.125817,0.070942,0.106881,0.076387,0.141571,0.081788},
{-23.552746,2.712917,-1.098127,0.192283,-0.035370,0.171694,-0.587603,0.089964,0.262863,0.187860,-0.115410,0.136967,0.033246,23.684218,0.652526,0.469805,0.316888,0.145667,0.186620,0.160889,0.067977,0.116918,0.092385,0.074225,0.086553,0.103485},
{-20.258868,0.709961,-1.045846,0.397235,0.524447,0.403586,-0.420334,-0.326471,-0.198212,0.060566,-0.194729,-0.180098,-0.055517,26.654357,0.955993,0.501976,0.186423,0.191377,0.175429,0.163586,0.105331,0.076758,0.103906,0.056752,0.097790,0.101293},
{-26.460010,1.764525,-0.598181,0.417565,-0.039737,-0.152130,-0.419247,-0.563185,-0.186841,0.164693,-0.151261,-0.184685,-0.268399,44.400312,0.559478,0.421281,0.155492,0.082141,0.195596,0.188718,0.074518,0.128707,0.056153,0.122648,0.063530,0.080856},
{-23.662207,1.554976,-0.673548,0.300180,0.264968,0.053662,-0.355005,0.051897,0.196386,0.135500,-0.059076,0.057901,-0.211170,56.901459,1.701142,1.764992,0.453780,0.140088,0.137734,0.122430,0.185218,0.089979,0.091137,0.113155,0.047132,0.051894},
{-21.466077,3.720945,-0.262730,0.336533,0.090696,0.062104,-0.521398,-0.544705,-0.438929,0.038816,-0.109003,-0.201009,-0.180042,45.189201,1.351215,0.281264,0.114373,0.112410,0.161000,0.097691,0.079869,0.120834,0.071193,0.064027,0.083243,0.059392},
{-21.907527,3.034383,-0.382181,0.307650,0.111291,-0.141009,-0.584476,-0.606532,-0.477946,-0.213326,-0.197188,-0.036240,-0.242908,59.137403,1.529801,0.257201,0.107073,0.102749,0.117154,0.076325,0.137898,0.193630,0.107863,0.075070,0.093253,0.043174},
{-23.243130,2.430525,-0.042407,0.263166,0.140869,-0.223116,-0.421970,-0.541554,-0.403411,0.041352,-0.084212,-0.140946,-0.133518,43.988012,2.256788,0.278434,0.201498,0.245870,0.123876,0.134062,0.136576,0.121478,0.055592,0.040432,0.089981,0.058249},
{-22.915378,3.680659,0.095279,0.414373,0.000655,-0.294554,-0.699682,-0.490292,-0.335727,-0.011475,-0.137094,0.055734,-0.070413,38.078446,1.763879,0.329024,0.127413,0.076690,0.116733,0.162292,0.178571,0.063710,0.074430,0.048009,0.081054,0.045845},
{-25.805874,1.761766,0.041008,0.529499,0.362624,-0.006684,-0.506381,-0.344368,-0.330441,0.076641,-0.049039,-0.142185,-0.191770,45.487498,0.534559,0.470408,0.129294,0.132250,0.138835,0.095793,0.108821,0.075038,0.103972,0.072629,0.094131,0.058685},
{-19.857250,2.816571,-0.327318,0.530520,0.423621,0.318366,-0.337250,-0.240374,-0.217225,0.182818,-0.199386,-0.127046,-0.180258,35.111464,0.694207,0.437650,0.237899,0.340741,0.172827,0.118270,0.130684,0.143487,0.063374,0.068600,0.070088,0.070572},
{-26.480945,2.918569,0.212380,0.790043,0.388440,0.160064,-0.422058,-0.426545,-0.266607,0.015784,0.060349,-0.021000,-0.294736,25.370977,0.864746,0.280153,0.104337,0.069048,0.073691,0.081631,0.120875,0.115307,0.114603,0.056723,0.080637,0.049766},
{-19.460665,3.057101,-0.328037,0.426510,0.266303,0.139731,-0.431548,-0.385993,-0.382700,0.167699,-0.134125,0.094632,-0.189508,23.156151,1.076100,0.509897,0.238120,0.219726,0.127072,0.092751,0.097557,0.061515,0.066382,0.118664,0.129044,0.076002},
{-20.133119,3.796497,-0.518751,0.313135,0.341875,0.124247,-0.103535,0.045369,0.015378,0.184577,-0.029133,-0.162117,-0.231951,34.027207,0.834604,0.819962,0.227730,0.173469,0.205121,0.089886,0.071767,0.108293,0.093700,0.123710,0.058771,0.042186},
{-12.621427,-0.514808,-1.088874,0.022185,0.178034,-0.480669,-0.762476,-0.714248,-0.185248,0.114741,-0.422113,-0.178428,-0.187570,12.947683,0.564330,0.193820,0.080062,0.107034,0.118878,0.114516,0.086015,0.086201,0.085987,0.070024,0.066568,0.096836},
{-18.949944,0.128577,-0.450541,0.665324,0.201018,-0.065475,-0.352514,-0.332324,0.023243,0.196382,-0.310172,-0.224195,-0.211288,84.363974,1.982685,0.149462,0.423040,0.240681,0.143704,0.069572,0.122863,0.106049,0.080623,0.206935,0.206902,0.111166},
{-20.837463,0.713695,-0.610977,0.130465,-0.246182,-0.365735,-0.753162,-0.484182,0.042103,-0.145197,-0.160308,0.004350,0.058410,83.217598,1.765198,0.352091,0.289248,0.274095,0.171422,0.238157,0.154301,0.111013,0.072316,0.150819,0.069569,0.066671},
{-22.221608,0.612829,0.026626,0.632641,0.128208,0.008725,-0.480236,-0.349610,0.236939,0.194608,0.015612,-0.008324,0.004077,73.751481,2.848563,1.056442,0.272090,0.252963,0.315613,0.172594,0.084159,0.137096,0.064744,0.241880,0.067201,0.114962},
{-23.505827,1.568790,0.032874,0.733774,-0.088041,-0.042429,-0.013286,-0.285498,-0.151144,-0.004576,-0.121360,-0.127857,0.136844,43.200272,1.270323,0.565952,0.363922,0.711959,0.292300,0.115336,0.232767,0.224572,0.162996,0.234796,0.058695,0.157358},
{-24.792671,1.380364,0.928683,1.030869,0.583172,0.377438,0.085901,-0.073293,0.249802,0.204599,0.060075,-0.027889,-0.015741,43.892122,1.900550,0.665426,0.472541,0.556952,0.310757,0.136430,0.343683,0.065706,0.117104,0.109862,0.098997,0.148445},
{-17.208804,1.785322,-0.326572,0.674159,0.487450,0.235507,-0.468839,-0.057504,-0.456201,-0.086850,-0.392854,0.104805,0.115595,50.756096,1.476937,0.184204,0.173068,0.189657,0.151518,0.176108,0.240267,0.098310,0.133366,0.094743,0.059197,0.066988},
{-24.509994,2.254806,0.194478,0.517569,0.134633,0.027330,-0.631558,-0.559491,-0.400737,0.051247,-0.000544,0.161309,0.022598,36.587518,0.974948,0.162883,0.106372,0.165351,0.125161,0.113993,0.123899,0.118204,0.075936,0.064290,0.074158,0.100762},
{-21.039321,1.792887,0.264921,0.642738,0.582641,0.368897,-0.281150,-0.176678,-0.330144,0.155748,-0.077478,0.043707,0.108082,53.928486,2.064974,1.148073,0.279800,0.212248,0.217729,0.239987,0.184793,0.134335,0.116847,0.129785,0.053324,0.101497},
{-16.483314,1.802619,-0.195503,0.677163,0.701467,0.205081,-0.476589,-0.101852,-0.408969,0.060977,-0.442289,0.126117,0.154691,25.129733,1.510832,0.499619,0.203008,0.125454,0.176979,0.123771,0.150489,0.096674,0.076372,0.111834,0.102816,0.070546},
{-24.213220,1.567355,0.322051,0.706751,0.284600,-0.197325,-0.544145,-0.306523,-0.437068,-0.053320,-0.166313,0.062219,-0.171886,39.456671,0.587372,0.381604,0.134191,0.150357,0.173137,0.194899,0.162420,0.114793,0.195959,0.090683,0.066847,0.062201},
{-25.990194,1.577785,-0.185113,0.400408,0.443376,0.007814,-0.576512,-0.421496,-0.093896,0.092125,0.058547,0.107550,-0.118792,67.784633,0.747861,0.592247,0.161755,0.186464,0.082423,0.098395,0.266221,0.100081,0.068942,0.112054,0.045654,0.076431},
{-18.473604,1.646320,-0.349056,0.500312,0.568516,-0.032857,-0.430817,-0.218785,-0.218149,0.163233,-0.352070,0.202927,-0.110808,65.292073,0.945570,0.399606,0.228815,0.248695,0.088559,0.154237,0.173372,0.108836,0.125833,0.084612,0.107462,0.093904},
{-24.251188,1.781078,-0.004314,0.481486,0.362204,-0.258701,-0.499516,-0.326099,-0.228804,-0.015745,-0.187380,0.111724,-0.226065,30.436546,0.148113,0.186654,0.113591,0.083840,0.204653,0.084525,0.066445,0.119710,0.101125,0.108070,0.116233,0.064491},
{-24.576405,1.642509,0.125211,0.469739,0.469480,0.096754,-0.395744,-0.462028,-0.192679,0.081918,-0.131889,0.109282,-0.115485,28.403059,0.134269,0.168905,0.202358,0.184708,0.098687,0.082541,0.094699,0.081869,0.080741,0.131156,0.082828,0.069338},
{-22.846117,1.381157,-0.302306,0.528240,0.001081,-0.003212,-0.143653,-0.168879,-0.006045,0.104464,-0.343400,-0.229157,-0.259079,49.172666,1.011333,0.242094,0.107048,0.204577,0.064749,0.093996,0.119166,0.121519,0.090875,0.096171,0.140448,0.071214},
{-19.064372,1.527320,-0.491663,0.776807,-0.346805,-0.769281,-0.702514,-0.531315,-0.349709,0.010684,-0.051001,0.330737,0.201302,22.644638,2.876590,0.529143,0.147977,0.119039,0.216435,0.136831,0.113860,0.111002,0.068485,0.102063,0.103813,0.060954},
{-25.117021,1.925665,-0.027827,0.773853,0.185983,-0.266568,-0.339714,-0.465526,-0.211365,0.022036,-0.186535,0.070631,0.037363,45.968798,1.460093,0.628718,0.108119,0.194365,0.320681,0.241273,0.166883,0.260571,0.155563,0.155219,0.065951,0.071111},
{-21.621903,1.683842,-0.479355,0.553550,0.004172,-0.493266,-0.697105,-0.783676,-0.561847,-0.270564,-0.115527,0.200064,0.226174,37.541251,1.552945,0.739340,0.165630,0.298045,0.316994,0.148125,0.249187,0.214239,0.179958,0.159696,0.201854,0.216846},
{-20.804556,1.888729,-0.839536,0.277611,-0.047482,-0.379143,-0.357118,-0.527247,0.120091,0.321463,-0.141225,-0.249517,-0.167106,12.397417,0.805274,0.437707,0.158295,0.063034,0.132423,0.092645,0.140466,0.113685,0.084542,0.070738,0.065247,0.085854},
{-18.983322,1.081273,-0.758883,0.525350,-0.067989,-0.205361,-0.343284,-0.395196,-0.103587,0.317012,-0.078788,-0.170650,0.061701,15.389914,1.915632,0.810283,0.169791,0.094696,0.390872,0.205276,0.144288,0.080292,0.104671,0.063061,0.039663,0.076964},
{-24.029364,1.731658,0.266673,1.170115,0.368110,0.392343,0.101507,-0.138037,0.158146,0.253726,0.089338,0.107793,-0.091851,46.934002,2.290172,0.867729,0.290566,0.500523,0.140855,0.155974,0.167832,0.138598,0.063404,0.056748,0.045849,0.053140},
{-22.967408,1.860221,-0.230940,0.520995,0.094679,0.017111,-0.339909,-0.457809,-0.083966,0.007465,-0.267955,-0.080287,-0.214305,59.174091,1.417928,0.361517,0.216565,0.120949,0.072948,0.169000,0.152735,0.093886,0.161547,0.111962,0.064557,0.080215},
{-22.683175,1.716814,-0.299525,0.326452,0.268676,0.135807,-0.383823,-0.332596,0.044081,0.089140,-0.200185,-0.053648,-0.053711,67.390212,1.161754,0.323717,0.131272,0.130990,0.090634,0.121958,0.115328,0.085914,0.094629,0.114491,0.080782,0.058803},
{-17.689654,2.360253,-0.697127,-0.174447,-0.013787,0.003844,-0.497244,-0.346121,-0.148676,-0.182287,-0.627157,-0.227920,-0.316581,7.228097,0.609463,0.259881,0.142898,0.107103,0.226063,0.139624,0.140752,0.056833,0.098657,0.060044,0.075840,0.068085},
{-26.311454,1.807525,0.167293,0.229452,-0.102589,-0.274391,-0.550947,-0.408105,-0.134086,-0.046551,-0.165389,-0.058307,-0.218112,47.052548,0.707494,0.256514,0.203797,0.194061,0.236677,0.127421,0.070980,0.110862,0.066290,0.094464,0.041061,0.045770},
{-18.794945,2.401952,0.188889,0.020841,-0.442299,-0.579417,-0.393752,-0.158342,0.105287,0.070791,-0.266380,-0.049578,-0.077075,29.519828,1.310907,1.097455,0.187024,0.271103,0.209093,0.118043,0.162603,0.255899,0.214657,0.079996,0.132790,0.071755},
{-19.661470,3.476386,1.098296,0.689789,0.192782,-0.568104,-0.685349,-0.227101,-0.131196,-0.235965,-0.512637,-0.405461,-0.567374,30.693445,1.093871,0.706710,0.168656,0.198293,0.224114,0.197553,0.255491,0.126128,0.137661,0.223890,0.260040,0.079260}};

float SupportVectorLabels[125]={1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1};

float Alpha[125]={1.000000,0.360344,1.000000,1.000000,1.000000,0.052341,0.180822,1.000000,1.000000,1.000000,1.000000,1.000000,0.277419,0.170542,0.776909,0.069474,0.299164,0.088473,1.000000,1.000000,0.980404,1.000000,1.000000,0.964476,1.000000,1.000000,1.000000,0.319243,1.000000,1.000000,1.000000,1.000000,0.060423,1.000000,1.000000,0.290898,0.754444,1.000000,0.446861,0.845512,1.000000,0.447151,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,0.058222,0.392983,0.151785,1.000000,0.128967,1.000000,1.000000,0.113013,1.000000,0.787262,0.665117,1.000000,1.000000,0.398442,1.000000,1.000000,0.719083,0.917885,0.226261,0.802209,1.000000,0.976162,0.734878,1.000000,0.602155,1.000000,1.000000,0.326620,0.472399,1.000000,0.394026,0.581577,1.000000,1.000000,0.355742,1.000000,0.992564,0.731433,0.295923,1.000000,0.978281,1.000000,0.558450,1.000000,1.000000,1.000000,1.000000,1.000000,0.027142,1.000000,0.123603,0.877537,1.000000,1.000000,0.378836,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,0.199448,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,1.000000,0.568066};
float Bias[4]={-5.236693218225857,-3.096485678836511,-1.536499944760325,-1.533885320485532};


void DMA2_Stream2_IRQHandler(void)
{ 
   int ii,j;
     float c=0,d=0;
     float earMag[40];
     float data[26];               
     
     int support_vector_size[4]={17,33,26,49},classlabel,class[4],length=0;    
     float buffer=0,buffer2=0;

  if(DMA_GetITStatus(DMA2_Stream2, DMA_IT_TCIF2))
 {
   /* Clear DMA Stream Transfer Complete interrupt pending bit */
    DMA_ClearITPendingBit(DMA2_Stream2, DMA_IT_TCIF2);
    for (i=0 ; i<windowLength ; i++)
        {
            usartreal[i]=(((float)usart[2*i]*256+(float)usart[2*i+1])/10000)-1;
            testInput[i].real = usartreal[i] * hamming_window[i];
            testInput[i].imag = 0;
        }
    
    for (i=0 ; i<windowLength/2 ; i++)
      nonpermanentbuffer[i]=usartreal[i+windowLength/2]; 
    
    arm_cfft_radix4_instance_f32 S; // complex fft ayarlarý iþleniyor         
        arm_cfft_radix4_init_f32(&S, windowLength,0, 1); // fft giriþi dörtlük birimlerle iþleniyor //        
        arm_cfft_radix4_f32(&S, (float32_t *)testInput);        
        arm_cmplx_mag_f32((float32_t *)testInput, testOutput, windowLength);  // fft büyüklüklerinin hesabý yapýlýyor //    
     k=1;
    
      for(i=0;i<40;i++)
        {
            c=0;
            for(j=0;j<80;j++)
                c=c+mfccParamsmfccFilterWeights[i][j]*testOutput[j];

            earMag[i]=log10(c + 0.00000000000000022204);
        }

        for(i=0;i<13;i++)
        {
            d=0;
            for(j=0;j<40;j++){
                d=d+mfccParamsmfccDCTMatrix[i][j]*earMag[j];
            }
            ceps[i]=d;
        }

        if(n<40)
        {
            for(i=0;i<13;i++)
            {
                mfccs_block[i][n]=ceps[i];
            }
            n++;
        }
        else
        {
            for(i=0;i<31;i++)
            {   
               collect=mfccs_block[0][i]+mfccs_block[0][i+1]+mfccs_block[0][i+2]+mfccs_block[0][i+3]+mfccs_block[0][i+4]+mfccs_block[0][i+5]+mfccs_block[0][i+6]+mfccs_block[0][i+7]+mfccs_block[0][i+8]+mfccs_block[0][i+9];
               collect2=collect;
               if( collect2 > -200)
               {
                    for(j=0;j<13;j++)
                    {
                        c=0;
                        for(ii=0;ii<40;ii++)
                        {
                            c=c+mfccs_block[j][ii];
                        }
                        data[j]=c/40;

                        d=0;
                        for(ii=0;ii<40;ii++)
                        {
                            d=d+pow((mfccs_block[j][ii]-data[j]),2);
                        }
                        data[j+13]=d/39;

                     }
                     break;
                  }

               }

               n=0;
               for(i=0;i<13;i++)
               {
                   mfccs_block[i][n]=ceps[i];
               }
               n++;
               
                if(data[1]!=0)
               {  
                  for (classlabel=0;classlabel<4;classlabel++)
                  {
                      buffer2=0;

                      for(i=length;i<support_vector_size[classlabel]+length;i++)
                      {
                          buffer=0;

                          for(j=0;j<26;j++)
                          {
                              buffer=buffer+data[j]*SupportVectors[i][j];
                          }

                          buffer2=buffer2+buffer*Alpha[i]*SupportVectorLabels[i];
                      }
                      length=support_vector_size[classlabel]+length;

                      class[classlabel]=(buffer2+Bias[classlabel])>0;

                      if(class[classlabel]==1)
                      {
                          GPIOD->BSRRH = 0xF000;
                          GPIOD->BSRRL = 0x1000<<classlabel; 
                          Delay(0x08FFFFFF);
                          GPIOD->BSRRH = 0xF000;
                          break;
                      }
                  }
              }
              for(i=0;i<26;i++)
                 data[i]=0;
    }
 }              
 if(DMA_GetITStatus(DMA2_Stream2, DMA_IT_HTIF2))
 {
  /* Clear DMA Stream Half Transfer interrupt pending bit */
  DMA_ClearITPendingBit(DMA2_Stream2, DMA_IT_HTIF2); 
  
  if(k==1)
  {
    for (i=0 ; i<windowLength/2 ; i++)
        {
            usartreal[i]=(((float)usart[2*i]*256+(float)usart[2*i+1])/10000)-1;
            testInput[i+windowLength/2].real = usartreal[i] * hamming_window[i+windowLength/2];
            testInput[i+windowLength/2].imag = 0;
            testInput[i].real=nonpermanentbuffer[i] * hamming_window[i];
            testInput[i].imag=0;
        }
       
        arm_cfft_radix4_instance_f32 S; // complex fft ayarlarý iþleniyor         
        arm_cfft_radix4_init_f32(&S, windowLength,0, 1); // fft giriþi dörtlük birimlerle iþleniyor //        
        arm_cfft_radix4_f32(&S, (float32_t *)testInput);        
        arm_cmplx_mag_f32((float32_t *)testInput, testOutput, windowLength);  // fft büyüklüklerinin hesabý yapýlýyor //    
    
      for(i=0;i<40;i++)
        {
            c=0;
            for(j=0;j<80;j++)
                c=c+mfccParamsmfccFilterWeights[i][j]*testOutput[j];

            earMag[i]=log10(c + 0.00000000000000022204);
        }

        for(i=0;i<13;i++)
        {
            d=0;
            for(j=0;j<40;j++){
                d=d+mfccParamsmfccDCTMatrix[i][j]*earMag[j];
            }
            ceps[i]=d;
        }

        if(n<40)
        {
            for(i=0;i<13;i++)
            {
                mfccs_block[i][n]=ceps[i];
            }
            n++;
        }
        else
        {
            for(i=0;i<31;i++)
            {   
               collect=mfccs_block[0][i]+mfccs_block[0][i+1]+mfccs_block[0][i+2]+mfccs_block[0][i+3]+mfccs_block[0][i+4]+mfccs_block[0][i+5]+mfccs_block[0][i+6]+mfccs_block[0][i+7]+mfccs_block[0][i+8]+mfccs_block[0][i+9];
               collect2=collect;
               if( collect2 > -200)
               {
                    for(j=0;j<13;j++)
                    {
                        c=0;
                        for(ii=0;ii<40;ii++)
                        {
                            c=c+mfccs_block[j][ii];
                        }
                        data[j]=c/40;

                        d=0;
                        for(ii=0;ii<40;ii++)
                        {
                            d=d+pow((mfccs_block[j][ii]-data[j]),2);
                        }
                        data[j+13]=d/39;

                     }
                     break;
                  }
               }

               n=0;
               for(i=0;i<13;i++)
               {
                   mfccs_block[i][n]=ceps[i];
               }
               n++;
               
               if(data[1]!=0)
               {           
                  for (classlabel=0;classlabel<4;classlabel++)
                  {
                      buffer2=0;

                      for(i=length;i<support_vector_size[classlabel]+length;i++)
                      {
                          buffer=0;

                          for(j=0;j<26;j++)
                          {
                              buffer=buffer+data[j]*SupportVectors[i][j];
                          }

                          buffer2=buffer2+buffer*Alpha[i]*SupportVectorLabels[i];
                      }
                      length=support_vector_size[classlabel]+length;

                      class[classlabel]=(buffer2+Bias[classlabel])>0;
        
                      if(class[classlabel]==1)
                      {
                          GPIOD->BSRRH = 0xF000;
                          GPIOD->BSRRL = 0x1000<<classlabel;
                          Delay(0x08FFFFFF);
                          GPIOD->BSRRH = 0xF000;
                          k=0;
                          break;
                      }
                  }
               }
               
               for(i=0;i<26;i++)
                 data[i]=0;
        }
  }
    
 }
}
    

int main(void)
{  
    feature_mfccs_init();
    USART1_Configuration(); 
    GPIO_Configuration();
    DMA_Configuration();
    NVIC_Configuration();
    
    for (i=0 ; i<windowLength ; i++)
    {
       hamming_window[i]=0.54-0.46*cos(2*Pi*i/(windowLength-1));
    }
    
    while(1);
}

